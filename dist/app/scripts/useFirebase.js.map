{"version":3,"sources":["useFirebase.js"],"names":["async","getDocumentsOrderedByField","collectionDB","querySnapshot","empty","console","log","orderBy","get","forEach","results","push","doc","let","error","data","Error","games","game2","game3","fieldName","newValue","await","db","runTransaction","transaction","docRef","currentValue","a","b","addOrUpdateDocument","maior","then","catch","updateDocumentStatus","desativado","set","listenToUpdates","collection","isInitialLoad","call","update","delete","onSnapshot","window","firebase","snapshot","docChanges","change","type","bridge","err","updateIfGreater","gameName","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","initFirebase","handlerControlStatusUser","email","deleteDocument","firebaseApp","handlerFormDB","handlerGameDB","point","listRankingDB","handlerSnapshotFormDB"],"mappings":"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","file":"useFirebase.js","sourcesContent":["window.firebaseConfig = {\n  apiKey: \"AIzaSyABeSs24iG5DaXYqe4hJIKBhBkiqdfC7og\",\n  authDomain: \"astrazeneca-csq.firebaseapp.com\",\n  projectId: \"astrazeneca-csq\",\n  storageBucket: \"astrazeneca-csq.firebasestorage.app\",\n  messagingSenderId: \"821833803001\",\n  appId: \"1:821833803001:web:85bba4ba444c197ac32e28\",\n  measurementId: \"G-KVR6EY12L7\",\n};\n\nasync function getDocumentsOrderedByField(collectionDB) {\n  try {\n    const querySnapshot = await collectionDB\n      .orderBy(\"point\", \"desc\")\n      .orderBy(\"time\", \"asc\")\n      .get();\n\n    if (querySnapshot.empty) {\n      console.log(\"No matching documents.\");\n      return [];\n    }\n\n    let results = [];\n    querySnapshot.forEach((doc) => {\n\n      results.push({\n        id: doc.id,\n        data: doc.data(),\n      });\n    });\n\n    console.log(\"results\", results);\n\n    return results;\n  } catch (error) {\n    console.error(\"Error retrieving documents: \", error);\n    return [];\n  }\n}\n\nasync function updateIfGreater(db, docRef, fieldName, newValue) {\n  try {\n    await db.runTransaction(async (transaction) => {\n      const doc = await transaction.get(docRef);\n      if (!doc.exists) {\n        throw new Error(\"Document does not exist!\");\n      }\n\n      const game1 = doc.data()[\"game1\"] || 0;\n      const game2 = doc.data()[\"game2\"] || 0;\n      const game3 = doc.data()[\"game3\"] || 0;\n      const games = [game1, game2, game3];\n      games.sort(function (a, b) {\n        return b - a;\n      });\n\n      const currentValue = doc.data()[fieldName] || 0;\n\n      if (newValue > currentValue) {\n        transaction.update(docRef, {\n          [fieldName]: newValue,\n          maior: newValue > games[0] ? newValue : games[0],\n        });\n        console.log(\"Field updated because the new value is greater.\");\n      } else {\n        console.log(\"Field not updated because the new value is not greater.\");\n      }\n    });\n  } catch (error) {\n    console.error(\"Transaction failed: \", error);\n  }\n}\n\nfunction addOrUpdateDocument(docRef, data) {\n  try {\n    docRef\n      .get()\n      .then((doc) => {\n        if (doc.exists) {\n          console.log(\"update\", docRef);\n          docRef\n            .update({\n              ...data,\n            })\n            .then(() => {\n              console.log(\"Document successfully update!\");\n            })\n            .catch((error) => {\n              console.error(\"Error update: \", error);\n            });\n        } else {\n          console.log(\"set\", docRef);\n          docRef\n            .set({\n              ...data,\n            })\n            .then(() => {\n              console.log(\"Document successfully written!\");\n            })\n            .catch((error) => {\n              console.error(\"Error writing document: \", error);\n            });\n        }\n      })\n      .catch((error) => {\n        console.log(\"Error set:\", error);\n      });\n  } catch (error) {\n    console.error(\"Erro ao adicionar ou atualizar documento: \", error);\n  }\n}\n\nfunction updateDocumentStatus(docRef, data) {\n  try {\n    docRef\n      .update({\n        desativado: data.desativado,\n      })\n      .then(() => {\n        console.log(\"Document successfully update Desativo!\");\n      })\n      .catch((error) => {\n        console.error(\"Error update Desativo: \", error);\n      });\n  } catch (error) {\n    console.error(\"Erro ao adicionar ou atualizar documento: \", error);\n  }\n}\n\nfunction listenToUpdates(collection, call) {\n  let isInitialLoad = true;\n\n  collection.onSnapshot(\n    (snapshot) => {\n      if (isInitialLoad) {\n        // Ignorar o primeiro snapshot, que é o estado inicial da coleção\n        isInitialLoad = false;\n        return;\n      }\n\n      snapshot.docChanges().forEach((change) => {\n        if (change.type === \"added\") {\n          console.log(\"New document: \", change.doc.data());\n          call(change);\n        }\n        if (change.type === \"modified\") {\n          console.log(\"Modified document: \", change.doc.data());\n          call(change);\n        }\n      });\n    },\n    (err) => {\n      console.log(`Encountered error: ${err}`);\n    }\n  );\n}\n\nfunction deleteDocument(docRef, call) {\n  docRef\n    .delete()\n    .then(() => {\n      console.log(\"Documento deletado com sucesso!\");\n      call();\n    })\n    .catch((error) => {\n      console.error(\"Erro ao deletar o documento: \", error);\n    });\n}\n\n///Inicialização do Firebase\nwindow.initFirebase = false;\n$(document).ready(function () {\n  if (!window.initFirebase) {\n    const firebaseApp = firebase.initializeApp(window.firebaseConfig);\n    window.db = firebaseApp.firestore();\n    window.collectionDB = window.db.collection(\"usuarios\");\n    window.initFirebase = true;\n  }\n});\n\n/// Criação do formulario\nbridge.handlerFormDB = function (data) {\n  const docRef = window.collectionDB.doc(data.email);\n  addOrUpdateDocument(docRef, data);\n};\n\n/// Criação da nota do game\nbridge.handlerGameDB = function (email, gameName, point) {\n  const docRef = window.collectionDB.doc(email);\n  updateIfGreater(window.db, docRef, gameName, point);\n};\n\n/// Criação da Ranking\nbridge.listRankingDB = function (call) {\n  getDocumentsOrderedByField(window.collectionDB)\n    .then((results) => {\n      console.log(\"Documents ordered by field in descending order:\");\n      call(results);\n    })\n    .catch((error) => {\n      console.error(\"Error in getDocumentsOrderedByField: \", error);\n    });\n};\n\n/// Controle do formulário via realtime - para mobile\nbridge.handlerSnapshotFormDB = function (call) {\n  listenToUpdates(window.collectionDB, call);\n};\n\n/// Controle de Status\nbridge.handlerControlStatusUser = function (data, call) {\n  console.log(data);\n  const docRef = window.collectionDB.doc(data.email);\n  deleteDocument(docRef, call);\n};\n"]}