{"version":3,"sources":["useFirebase.js"],"names":["async","getDocumentsOrderedByField","collectionDB","querySnapshot","empty","console","log","orderBy","get","forEach","results","push","doc","let","error","data","db","game2","docRef","fieldName","newValue","await","games","game3","sort","transaction","b","Error","update","currentValue","a","addOrUpdateDocument","then","desativado","isInitialLoad","collection","onSnapshot","updateDocumentStatus","type","err","deleteDocument","catch","call","snapshot","document","window","initFirebase","change","handlerFormDB","handlerGameDB","gameName","updateIfGreater","bridge","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","$","ready","handlerControlStatusUser","initializeApp","firestore","email","point","listRankingDB","handlerSnapshotFormDB","listenToUpdates"],"mappings":"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","file":"useFirebase.js","sourcesContent":["window.firebaseConfig = {\n  apiKey: \"AIzaSyABeSs24iG5DaXYqe4hJIKBhBkiqdfC7og\",\n  authDomain: \"astrazeneca-csq.firebaseapp.com\",\n  projectId: \"astrazeneca-csq\",\n  storageBucket: \"astrazeneca-csq.firebasestorage.app\",\n  messagingSenderId: \"821833803001\",\n  appId: \"1:821833803001:web:85bba4ba444c197ac32e28\",\n  measurementId: \"G-KVR6EY12L7\",\n};\n\nasync function getDocumentsOrderedByField(collectionDB) {\n  try {\n    const querySnapshot = await collectionDB\n      .orderBy(\"point\", \"desc\")\n      .orderBy(\"time\", \"asc\")\n      .get();\n\n    if (querySnapshot.empty) {\n      console.log(\"No matching documents.\");\n      return [];\n    }\n\n    let results = [];\n    querySnapshot.forEach((doc) => {\n      results.push({\n        id: doc.id,\n        data: doc.data(),\n      });\n    });\n\n    return results;\n  } catch (error) {\n    console.error(\"Error retrieving documents: \", error);\n    return [];\n  }\n}\n\nasync function updateIfGreater(db, docRef, fieldName, newValue) {\n  try {\n    await db.runTransaction(async (transaction) => {\n      const doc = await transaction.get(docRef);\n      if (!doc.exists) {\n        throw new Error(\"Document does not exist!\");\n      }\n\n      const game1 = doc.data()[\"game1\"] || 0;\n      const game2 = doc.data()[\"game2\"] || 0;\n      const game3 = doc.data()[\"game3\"] || 0;\n      const games = [game1, game2, game3];\n      games.sort(function (a, b) {\n        return b - a;\n      });\n\n      const currentValue = doc.data()[fieldName] || 0;\n\n      if (newValue > currentValue) {\n        transaction.update(docRef, {\n          [fieldName]: newValue,\n          maior: newValue > games[0] ? newValue : games[0],\n        });\n        console.log(\"Field updated because the new value is greater.\");\n      } else {\n        console.log(\"Field not updated because the new value is not greater.\");\n      }\n    });\n  } catch (error) {\n    console.error(\"Transaction failed: \", error);\n  }\n}\n\nfunction addOrUpdateDocument(docRef, data) {\n  try {\n    docRef\n      .get()\n      .then((doc) => {\n        if (doc.exists) {\n          console.log(\"update\", docRef);\n          docRef\n            .update({\n              ...data,\n            })\n            .then(() => {\n              console.log(\"Document successfully update!\");\n            })\n            .catch((error) => {\n              console.error(\"Error update: \", error);\n            });\n        } else {\n          console.log(\"set\", docRef);\n          docRef\n            .set({\n              ...data,\n            })\n            .then(() => {\n              console.log(\"Document successfully written!\");\n            })\n            .catch((error) => {\n              console.error(\"Error writing document: \", error);\n            });\n        }\n      })\n      .catch((error) => {\n        console.log(\"Error set:\", error);\n      });\n  } catch (error) {\n    console.error(\"Erro ao adicionar ou atualizar documento: \", error);\n  }\n}\n\nfunction updateDocumentStatus(docRef, data) {\n  try {\n    docRef\n      .update({\n        desativado: data.desativado,\n      })\n      .then(() => {\n        console.log(\"Document successfully update Desativo!\");\n      })\n      .catch((error) => {\n        console.error(\"Error update Desativo: \", error);\n      });\n  } catch (error) {\n    console.error(\"Erro ao adicionar ou atualizar documento: \", error);\n  }\n}\n\nfunction listenToUpdates(collection, call) {\n  let isInitialLoad = true;\n\n  collection.onSnapshot(\n    (snapshot) => {\n      if (isInitialLoad) {\n        // Ignorar o primeiro snapshot, que é o estado inicial da coleção\n        isInitialLoad = false;\n        return;\n      }\n\n      snapshot.docChanges().forEach((change) => {\n        if (change.type === \"added\") {\n          console.log(\"New document: \", change.doc.data());\n          call(change);\n        }\n        if (change.type === \"modified\") {\n          console.log(\"Modified document: \", change.doc.data());\n          call(change);\n        }\n      });\n    },\n    (err) => {\n      console.log(`Encountered error: ${err}`);\n    }\n  );\n}\n\nfunction deleteDocument(docRef, call) {\n  docRef\n    .delete()\n    .then(() => {\n      console.log(\"Documento deletado com sucesso!\");\n      call();\n    })\n    .catch((error) => {\n      console.error(\"Erro ao deletar o documento: \", error);\n    });\n}\n\n///Inicialização do Firebase\nwindow.initFirebase = false;\n$(document).ready(function () {\n  if (!window.initFirebase) {\n    const firebaseApp = firebase.initializeApp(window.firebaseConfig);\n    window.db = firebaseApp.firestore();\n    window.collectionDB = window.db.collection(\"usuarios\");\n    window.initFirebase = true;\n  }\n});\n\n/// Criação do formulario\nbridge.handlerFormDB = function (data) {\n  const docRef = window.collectionDB.doc(data.email);\n  addOrUpdateDocument(docRef, data);\n};\n\n/// Criação da nota do game\nbridge.handlerGameDB = function (email, gameName, point) {\n  const docRef = window.collectionDB.doc(email);\n  updateIfGreater(window.db, docRef, gameName, point);\n};\n\n/// Criação da Ranking\nbridge.listRankingDB = function (call) {\n  getDocumentsOrderedByField(window.collectionDB)\n    .then((results) => {\n      console.log(\"Documents ordered by field in descending order:\");\n      call(results);\n    })\n    .catch((error) => {\n      console.error(\"Error in getDocumentsOrderedByField: \", error);\n    });\n};\n\n/// Controle do formulário via realtime - para mobile\nbridge.handlerSnapshotFormDB = function (call) {\n  listenToUpdates(window.collectionDB, call);\n};\n\n/// Controle de Status\nbridge.handlerControlStatusUser = function (data, call) {\n  console.log(data);\n  const docRef = window.collectionDB.doc(data.email);\n  deleteDocument(docRef, call);\n};\n"]}