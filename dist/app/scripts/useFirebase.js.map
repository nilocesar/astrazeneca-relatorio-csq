{"version":3,"sources":["useFirebase.js"],"names":["async","getDocumentsOrderedByField","collectionDB","querySnapshot","empty","console","log","get","results","forEach","let","doc","id","error","data","runTransaction","game1","db","docRef","fieldName","newValue","await","game3","transaction","games","sort","Error","maior","currentValue","update","a","b","addOrUpdateDocument","exists","then","updateDocumentStatus","desativado","catch","listenToUpdates","isInitialLoad","collection","snapshot","change","call","onSnapshot","initFirebase","window","docChanges","firebaseApp","firestore","type","handlerFormDB","err","bridge","deleteDocument","listRankingDB","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","$","document","ready","firebase","initializeApp","handlerControlStatusUser","email","handlerGameDB","gameName","point","updateIfGreater","handlerSnapshotFormDB"],"mappings":"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","file":"useFirebase.js","sourcesContent":["window.firebaseConfig = {\n  apiKey: \"AIzaSyABeSs24iG5DaXYqe4hJIKBhBkiqdfC7og\",\n  authDomain: \"astrazeneca-csq.firebaseapp.com\",\n  projectId: \"astrazeneca-csq\",\n  storageBucket: \"astrazeneca-csq.firebasestorage.app\",\n  messagingSenderId: \"821833803001\",\n  appId: \"1:821833803001:web:85bba4ba444c197ac32e28\",\n  measurementId: \"G-KVR6EY12L7\",\n};\n\nasync function getDocumentsOrderedByField(collectionDB) {\n  try {\n    const querySnapshot = await collectionDB\n      .orderBy(\"point\", \"desc\")\n      .get();\n\n    if (querySnapshot.empty) {\n      console.log(\"No matching documents.\");\n      return [];\n    }\n\n    let results = [];\n    querySnapshot.forEach((doc) => {\n      results.push({\n        id: doc.id,\n        data: doc.data(),\n      });\n    });\n\n    return results;\n  } catch (error) {\n    console.error(\"Error retrieving documents: \", error);\n    return [];\n  }\n}\n\nasync function updateIfGreater(db, docRef, fieldName, newValue) {\n  try {\n    await db.runTransaction(async (transaction) => {\n      const doc = await transaction.get(docRef);\n      if (!doc.exists) {\n        throw new Error(\"Document does not exist!\");\n      }\n\n      const game1 = doc.data()[\"game1\"] || 0;\n      const game2 = doc.data()[\"game2\"] || 0;\n      const game3 = doc.data()[\"game3\"] || 0;\n      const games = [game1, game2, game3];\n      games.sort(function (a, b) {\n        return b - a;\n      });\n\n      const currentValue = doc.data()[fieldName] || 0;\n\n      if (newValue > currentValue) {\n        transaction.update(docRef, {\n          [fieldName]: newValue,\n          maior: newValue > games[0] ? newValue : games[0],\n        });\n        console.log(\"Field updated because the new value is greater.\");\n      } else {\n        console.log(\"Field not updated because the new value is not greater.\");\n      }\n    });\n  } catch (error) {\n    console.error(\"Transaction failed: \", error);\n  }\n}\n\nfunction addOrUpdateDocument(docRef, data) {\n  try {\n    docRef\n      .get()\n      .then((doc) => {\n        if (doc.exists) {\n          console.log(\"update\", docRef);\n          docRef\n            .update({\n              ...data,\n            })\n            .then(() => {\n              console.log(\"Document successfully update!\");\n            })\n            .catch((error) => {\n              console.error(\"Error update: \", error);\n            });\n        } else {\n          console.log(\"set\", docRef);\n          docRef\n            .set({\n              ...data,\n            })\n            .then(() => {\n              console.log(\"Document successfully written!\");\n            })\n            .catch((error) => {\n              console.error(\"Error writing document: \", error);\n            });\n        }\n      })\n      .catch((error) => {\n        console.log(\"Error set:\", error);\n      });\n  } catch (error) {\n    console.error(\"Erro ao adicionar ou atualizar documento: \", error);\n  }\n}\n\nfunction updateDocumentStatus(docRef, data) {\n  try {\n    docRef\n      .update({\n        desativado: data.desativado,\n      })\n      .then(() => {\n        console.log(\"Document successfully update Desativo!\");\n      })\n      .catch((error) => {\n        console.error(\"Error update Desativo: \", error);\n      });\n  } catch (error) {\n    console.error(\"Erro ao adicionar ou atualizar documento: \", error);\n  }\n}\n\nfunction listenToUpdates(collection, call) {\n  let isInitialLoad = true;\n\n  collection.onSnapshot(\n    (snapshot) => {\n      if (isInitialLoad) {\n        // Ignorar o primeiro snapshot, que é o estado inicial da coleção\n        isInitialLoad = false;\n        return;\n      }\n\n      snapshot.docChanges().forEach((change) => {\n        if (change.type === \"added\") {\n          console.log(\"New document: \", change.doc.data());\n          call(change);\n        }\n        if (change.type === \"modified\") {\n          console.log(\"Modified document: \", change.doc.data());\n          call(change);\n        }\n      });\n    },\n    (err) => {\n      console.log(`Encountered error: ${err}`);\n    }\n  );\n}\n\nfunction deleteDocument(docRef, call) {\n  docRef\n    .delete()\n    .then(() => {\n      console.log(\"Documento deletado com sucesso!\");\n      call();\n    })\n    .catch((error) => {\n      console.error(\"Erro ao deletar o documento: \", error);\n    });\n}\n\n///Inicialização do Firebase\nwindow.initFirebase = false;\n$(document).ready(function () {\n  if (!window.initFirebase) {\n    const firebaseApp = firebase.initializeApp(window.firebaseConfig);\n    window.db = firebaseApp.firestore();\n    window.collectionDB = window.db.collection(\"usuarios\");\n    window.initFirebase = true;\n  }\n});\n\n/// Criação do formulario\nbridge.handlerFormDB = function (data) {\n  const docRef = window.collectionDB.doc(data.email);\n  addOrUpdateDocument(docRef, data);\n};\n\n/// Criação da nota do game\nbridge.handlerGameDB = function (email, gameName, point) {\n  const docRef = window.collectionDB.doc(email);\n  updateIfGreater(window.db, docRef, gameName, point);\n};\n\n/// Criação da Ranking\nbridge.listRankingDB = function (call) {\n  getDocumentsOrderedByField(window.collectionDB)\n    .then((results) => {\n      console.log(\"Documents ordered by field in descending order:\");\n      call(results);\n    })\n    .catch((error) => {\n      console.error(\"Error in getDocumentsOrderedByField: \", error);\n    });\n};\n\n/// Controle do formulário via realtime - para mobile\nbridge.handlerSnapshotFormDB = function (call) {\n  listenToUpdates(window.collectionDB, call);\n};\n\n/// Controle de Status\nbridge.handlerControlStatusUser = function (data, call) {\n  console.log(data);\n  const docRef = window.collectionDB.doc(data.email);\n  deleteDocument(docRef, call);\n};\n"]}